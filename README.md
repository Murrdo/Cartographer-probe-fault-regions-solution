# Cartographer-probe-fault-regions-solution

Этот гайд может помочь если у вы столкнулись с тем, что картографер снимает неверный меш и у вас есть одна или несколько полос/областей более менее параллельных осям принтера с провисающим первым слоем или слоем "гармошкой", и при этом у вас нет реального перекрута осей.

Результат до:

![image](https://github.com/user-attachments/assets/9d96c158-fff3-453d-8174-94d98f0a32e6)


Результат после:
![После](https://i.ibb.co/P6m4vfm/image.png)


Возможно проблема вызвана неоднородностью "магнитных свойств" каждой конкретной пластины, у меня из 4х пластин в наличии на всех были проблемные области, при повороте пластины на 90гр область поворачивается вместе с пластиной, реального перекрута осей нет, на механическом таче результат хороший. Но при этом есть НЕБОЛЬШОЕ сходство проблемных областей на разных пластинах, так что может быть это результат взаимодействия пластины с "магнитным полем" всего принтера и/или стола и магнита.

Идея в том что бы использовать компенсацию перекрута осей в клиппере для компенсации этого явления при том что реального перекрута может и не быть. 

Да статья огромная, а звучит всё просто - сделайте компенсацию и всё будет ок, это первый совет который я услышал когда стал искать помощи в решении этой проблемы, но в процессе есть несколько нюансов без которых способ не сработает и станет только хуже. Дело в том что компенсация перекрута даже близко не задумывалась использоваться таким образом как здесь, её задача устранить погрешность в десятку-две по всей длинне стола, а не бороться с локальным "горбом" длинной в десятки миллиметров.

Так или иначе - штатные способы калибровки перекрута не работают, что авто, что в ручную даже по 30 точкам. В чём причина у меня уже нет сил разбираться, ручная калибровка с большим количеством точек была бы самой дружелюбной для пользователя, но увы она дает плохой результат по непонятной мне причине.

Осторожно - гайд сыроват и написан больше под себя - что и как я привык делать, некоторые пункты могут быть для вас лишними, некоторые оставляю для подстраховки. 
Но всё же рекомендую строго следовать всей последовательности т.к. почти каждый пункт был рожден в попоболью от 10-15го переделывая всего по кругу или вылезания в процессе нюанса из-за которого всё нужно переделывать по новой.

### Подготовка:

Убрать (если есть) секцию AXIS_TWIST в самом низу конфига, иначе новая калибровка будет происходить **==ПОВЕРХ==** уже работающего AXIS_TWIST и получиться полный бред

Перезагрузить прошивку

Нагреть сопло до 250гр, дождаться пока перестанет давить старый пластик и как следует почистить его кончик латунной щеткой или чем вы привыкли - охладить ниже 60гр (очень сильно облегчит задачу в дальнейшем)

Откалибровать модель стола картографера в ручную - CARTOGRAPHER_CALIBRATE METHOD=MANUAL

Здесь и в дальнейшем предполагаю что вы используете такой способ ручной калибровки офсета -  берется стальной щуп толщиной 3-5соток, сопло двигается к столу до тех пор пока щуп будет проходить с натягом, после чего сопло двигается вниз на толщину щупа т.е. что бы получить реальный 0.

Перезагрузить прошивку

В любом удобном месте конфига создаём  секцию

```c
[axis_twist_compensation]
#для уполщения процесса советую создать здесь "линейку" что бы было проще ориентироваться к каким координатам примениться офсет. Но линейку нужно спозиционировать по несколькоим точкам, т.е. например меняется несколько значений в zy_compensations на +1, перезагружаетесь - снимаете меш, смотрите какая точка какой координате соответствует и заполняете линейку для что бы координаты соответствовали реальным.
#-----------        20     30     40     50      60    70     80     90     100   110    120     130    140   150     160    170    180    190   200    210    220    230    240    250    260    270    280    290    300    310    320     330
zy_compensations = +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00, +0.00,
#здесь мы создаёт массив точек (офсетов) для корректировки дефекта, их количество должно быть НЕЧЁТНЫМ, [количество]/[max-mix]=расстояние между точками, его следует выбирать соразмерным дефективной области и крутизне её начала или конца
compensation_start_y = 
compensation_end_y = 
#координаты начала области калибровки и её конца, лучше делать во весь стол, я пробовал задавать компенсацию только в проблемной области но работает криво. Основной момент - точки должны быть СИММЕТРИЧНЫ относительно [bed_mesh] zero_reference_position: 164, 162 
#для конкретной оси. Тут же мы указываем ось, вдоль какой оси дефектная область - ту ось и указываем
```


#### Калибровка:

Далее наша задача любым удобным образом составить представление о проблемной области:

1.Можно просто напечатать первый слой во весь стол, снять пластину и измерить линейкой примерные координаты её начала или конца
2.Можно заранее снять качественный детальный меш механическим тачем и сравнить его с тем что выдает картографер

Например, вот результат механической пробы:

![Механика](https://i.ibb.co/SBsXzr7/image.png)

А это меш снимаемый картографером

![Cartographer](https://i.ibb.co/GkhkchQ/image.png)

Сопоставляя график и проблемные области на первом слое видимо две проблемные области, первая небольшая в диапазоне Y65-Y100, вторая огромная по  Y185-Н270.

И начинаем в ручную корректировать коэффициенты в секции перекрута пересканируя стол пока не получите график близкий к механике.

Запредельной точности не нужно, отклонение в 2-3 сотки  на качестве первого слоя не сказывается.

Очень важный момент - если точка хоуминга у вас внутри проблемной области - после каждого изменения возможно есть смысл сделать ручную калибровку модели картографера, CARTOGRAPHER_CALIBRATE METHOD=MANUAL и возможно даже CARTOGRAPHER_THRESHOLD_SCAN

По завершению/перед тестовой печатью обязательно перекалибровываем модель картографера CARTOGRAPHER_CALIBRATE METHOD=MANUAL

Финально корректируем офсеты по реальной печати первого слоя, можно уже не во весь стол главное бы тест пересекал проблемную область.

Результат после калибровки, дающий хороший первый слой



![Cartographer](https://i.ibb.co/w72HRtx/image.png)

Из разряда неудобств - это придеться делать под каждую проблемную пластину, а при установке беспроблемной пластины секцию перекрута нужно удалять из конфига
